<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Micro Tool</title>
  <style>
    :root{--bg:#f5f7fb;--card:#fff;--text:#0f172a;--muted:#64748b;--brand:#2563eb;--border:#e2e8f0;--ok:#16a34a;--warn:#b45309}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:760px;margin:24px auto;padding:0 14px}.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 8px 24px rgba(2,8,23,.06)}
    h1{margin:0 0 6px;font-size:28px}.muted{color:var(--muted)} .small{font-size:12px;color:var(--muted)}
    .credits{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0}.pill{border:1px solid var(--border);border-radius:12px;padding:10px}.pill b{display:block}
    textarea{width:100%;min-height:120px;border:1px solid var(--border);border-radius:12px;padding:12px;font-size:15px}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}.btn{border:0;background:var(--brand);color:#fff;border-radius:10px;padding:11px 16px;font-weight:600;cursor:pointer}.btn.alt{background:#fff;color:var(--text);border:1px solid var(--border)}
    .output{margin-top:14px;border:1px solid var(--border);border-radius:12px;padding:12px;background:#fcfdff;white-space:pre-wrap;line-height:1.55;min-height:74px}
    .paywall{margin-top:14px;padding:14px;border:1px solid #fed7aa;background:#fff7ed;border-radius:12px}.hide{display:none}
    .faq{margin-top:14px;padding-top:10px;border-top:1px dashed var(--border)} footer{margin-top:14px;padding-top:12px;border-top:1px dashed var(--border)} a{color:var(--brand);text-decoration:none}
    .ok{color:var(--ok)} .warn{color:var(--warn)}
  </style>
</head>
<body>
<div class="wrap"><div class="card">
  <h1>AI Micro Tool</h1>
  <p class="muted">Generate polished results from a single prompt — fast, simple, and affordable.</p>

  <div class="credits">
    <div class="pill"><span class="small">Free uses left today</span><b id="freeLeft">—</b></div>
    <div class="pill"><span class="small">Paid credits</span><b id="paidCredits">—</b></div>
  </div>

  <label class="small" for="prompt">Your input</label>
  <textarea id="prompt" placeholder="Describe what you want..."></textarea>
  <div class="row">
    <button id="genBtn" class="btn" onclick="useTool()">Generate</button>
    <button class="btn alt" onclick="loadCredits()">Refresh credits</button>
  </div>
  <p id="status" class="small"></p>
  <div id="output" class="output">Your output will appear here.</div>

  <div id="paywall" class="paywall hide">
    <h3>Unlock 100 credits for $1</h3>
    <p><b>PayPal:</b> Pay using your checkout link/button, then return here and refresh credits.</p>
    <p><b>Pay with Syriatel/MTN:</b> Send payment proof to support with your User ID.</p>
    <p class="small" id="uidLine"></p>
    <div class="row">
      <button class="btn alt" onclick="copyUserId()">Copy User ID</button>
      <button class="btn alt" onclick="copyLocalMessage()">Copy message text</button>
      <button class="btn alt" onclick="requestLocalUnlock()">Request local unlock</button>
    </div>
  </div>

  <section class="faq">
    <h3>FAQ</h3>
    <ul>
      <li><b>What is 1 credit?</b> One successful Generate request.</li>
      <li><b>Do paid credits expire?</b> No, paid credits do not expire by default.</li>
      <li><b>Do free uses reset?</b> Yes, free uses reset daily (3/day).</li>
    </ul>
  </section>

  <footer class="small">
    <a href="#">Terms</a> · <a href="#">Privacy</a>
  </footer>
</div></div>
<script>
const key='micro_saas_user_id';
let uid=localStorage.getItem(key); if(!uid){uid='u_'+Math.random().toString(36).slice(2,10);localStorage.setItem(key,uid)}
document.getElementById('uidLine').textContent='User ID: '+uid;
function setStatus(m,c=''){const e=document.getElementById('status');e.textContent=m||'';e.className='small '+c;}
function togglePaywall(show){document.getElementById('paywall').classList.toggle('hide',!show)}
async function loadCredits(){try{const r=await fetch('/api/credits?user='+encodeURIComponent(uid));const d=await r.json();const f=Number(d.freeLeft||0),p=Number(d.paid||0);freeLeft.textContent=String(f);paidCredits.textContent=String(p);togglePaywall((f+p)<=0);setStatus('Credits updated','ok')}catch{setStatus('Could not load credits','warn')}}
async function useTool(){const btn=genBtn;const prompt=(document.getElementById('prompt').value||'').trim()||'Say hello';btn.disabled=true;btn.textContent='Generating...';setStatus('');try{const r=await fetch('/api/use',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({user_id:uid,prompt})});const d=await r.json();if(!r.ok||d.error==='insufficient_credits'){output.textContent='You are out of credits. Please unlock to continue.';togglePaywall(true);setStatus('No credits left','warn');return;}output.textContent=d.result||'Done.';if(d.credits){freeLeft.textContent=String(d.credits.freeLeft??0);paidCredits.textContent=String(d.credits.paid??0);togglePaywall((Number(d.credits.freeLeft||0)+Number(d.credits.paid||0))<=0)}setStatus('Generated successfully','ok')}catch{setStatus('Request failed. Try again.','warn')}finally{btn.disabled=false;btn.textContent='Generate'}}
function copyUserId(){navigator.clipboard.writeText(uid).then(()=>setStatus('User ID copied','ok')).catch(()=>setStatus('Copy failed','warn'))}
function copyLocalMessage(){const txt=`Local unlock request\nUser ID: ${uid}\nNetwork: Syriatel/MTN\nPayment proof attached.`;navigator.clipboard.writeText(txt).then(()=>setStatus('Message copied','ok')).catch(()=>setStatus('Copy failed','warn'))}
function requestLocalUnlock(){const msg=encodeURIComponent(`Local unlock request\nUser ID: ${uid}\nNetwork: Syriatel/MTN\nPayment proof attached.`);window.location.href=`mailto:support@petsy.company?subject=Local%20Unlock%20Request&body=${msg}`}
loadCredits();
</script>
</body>
</html>
